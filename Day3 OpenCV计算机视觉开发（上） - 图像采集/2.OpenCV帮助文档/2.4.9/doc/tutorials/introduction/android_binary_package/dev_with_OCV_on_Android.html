
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-33108845-1']);
  _gaq.push(['_setDomainName', 'opencv.org']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Android Development with OpenCV &mdash; OpenCV 2.4.9.0 documentation</title>
    <link rel="stylesheet" href="../../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '2.4.9.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../../../../../_static/insertIframe.js"></script>
    <link rel="top" title="OpenCV 2.4.9.0 documentation" href="../../../../index.html" />
    <link rel="up" title="Introduction to OpenCV" href="../table_of_content_introduction/table_of_content_introduction.html" />
    <link rel="next" title="Installation in iOS" href="../ios_install/ios_install.html" />
    <link rel="prev" title="OpenCV4Android SDK" href="O4A_SDK.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../ios_install/ios_install.html" title="Installation in iOS"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="O4A_SDK.html" title="OpenCV4Android SDK"
             accesskey="P">previous</a> |</li>
        <li><a href="../../../../index.html">OpenCV 2.4.9.0 documentation</a> &raquo;</li>
          <li><a href="../../tutorials.html" >OpenCV Tutorials</a> &raquo;</li>
          <li><a href="../table_of_content_introduction/table_of_content_introduction.html" accesskey="U">Introduction to OpenCV</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
  
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="android-development-with-opencv">
<span id="dev-with-ocv-on-android"></span><h1>Android Development with OpenCV<a class="headerlink" href="#android-development-with-opencv" title="Permalink to this headline">¶</a></h1>
<p>This tutorial has been created to help you use OpenCV library within your Android project.</p>
<p>This guide was written with Windows 7 in mind, though it should work with any other OS supported by
OpenCV4Android SDK.</p>
<p>This tutorial assumes you have the following installed and configured:</p>
<ul>
<li><p class="first">JDK</p>
</li>
<li><p class="first">Android SDK and NDK</p>
</li>
<li><p class="first">Eclipse IDE</p>
</li>
<li><p class="first">ADT and CDT plugins for Eclipse</p>
<blockquote>
<div></div></blockquote>
</li>
</ul>
<p>If you need help with anything of the above, you may refer to our <a class="reference internal" href="android_dev_intro.html#android-dev-intro"><em>Introduction into Android Development</em></a> guide.</p>
<p>This tutorial also assumes you have OpenCV4Android SDK already installed on your development
machine and OpenCV Manager on your testing device correspondingly. If you need help with any of
these, you may consult our <a class="reference internal" href="O4A_SDK.html#o4a-sdk"><em>OpenCV4Android SDK</em></a> tutorial.</p>
<p>If you encounter any error after thoroughly following these steps, feel free to contact us via
<a class="reference external" href="https://groups.google.com/group/android-opencv/">OpenCV4Android</a> discussion group or OpenCV
<a class="reference external" href="http://answers.opencv.org">Q&amp;A forum</a> . We&#8217;ll do our best to help you out.</p>
<div class="section" id="using-opencv-library-within-your-android-project">
<h2>Using OpenCV Library Within Your Android Project<a class="headerlink" href="#using-opencv-library-within-your-android-project" title="Permalink to this headline">¶</a></h2>
<p>In this section we will explain how to make some existing project to use OpenCV.
Starting with 2.4.2 release for Android, <em>OpenCV Manager</em> is used to provide apps with the best
available version of OpenCV.
You can get more information here: <a class="reference internal" href="../../../../platforms/android/service/doc/index.html#android-opencv-manager"><em>Android OpenCV Manager</em></a> and in these
<a class="reference external" href="https://docs.google.com/a/itseez.com/presentation/d/1EO_1kijgBg_BsjNp2ymk-aarg-0K279_1VZRcPplSuk/present#slide=id.p">slides</a>.</p>
<div class="section" id="java">
<h3>Java<a class="headerlink" href="#java" title="Permalink to this headline">¶</a></h3>
<div class="section" id="application-development-with-async-initialization">
<h4>Application Development with Async Initialization<a class="headerlink" href="#application-development-with-async-initialization" title="Permalink to this headline">¶</a></h4>
<p>Using async initialization is a <strong>recommended</strong> way for application development. It uses the OpenCV
Manager to access OpenCV libraries externally installed in the target system.</p>
<ol class="arabic">
<li><p class="first">Add OpenCV library project to your workspace. Use menu
<em class="guilabel">File -&gt; Import -&gt; Existing project in your workspace</em>.</p>
<p>Press <em class="guilabel">Browse</em>  button and locate OpenCV4Android SDK
(<tt class="file docutils literal"><span class="pre">OpenCV-2.4.9-android-sdk/sdk</span></tt>).</p>
<img alt="Add dependency from OpenCV library" class="align-center" src="../../../../_images/eclipse_opencv_dependency0.png" />
</li>
<li><p class="first">In application project add a reference to the OpenCV Java SDK in
<em class="guilabel">Project -&gt; Properties -&gt; Android -&gt; Library -&gt; Add</em> select <tt class="docutils literal"><span class="pre">OpenCV</span> <span class="pre">Library</span> <span class="pre">-</span> <span class="pre">2.4.9</span></tt>.</p>
<img alt="Add dependency from OpenCV library" class="align-center" src="../../../../_images/eclipse_opencv_dependency1.png" />
</li>
</ol>
<p>In most cases OpenCV Manager may be installed automatically from Google Play. For the case, when
Google Play is not available, i.e. emulator, developer board, etc, you can install it manually
using adb tool. See <a class="reference internal" href="../../../../platforms/android/service/doc/UseCases.html#manager-selection"><em>How to select the proper version of OpenCV Manager</em></a> for details.</p>
<p>There is a very base code snippet implementing the async initialization. It shows basic principles.
See the &#8220;15-puzzle&#8221; OpenCV sample for details.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Sample1Java</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="kd">implements</span> <span class="n">CvCameraViewListener</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">BaseLoaderCallback</span> <span class="n">mLoaderCallback</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BaseLoaderCallback</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onManagerConnected</span><span class="o">(</span><span class="kt">int</span> <span class="n">status</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">switch</span> <span class="o">(</span><span class="n">status</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">case</span> <span class="n">LoaderCallbackInterface</span><span class="o">.</span><span class="na">SUCCESS</span><span class="o">:</span>
                <span class="o">{</span>
                    <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;OpenCV loaded successfully&quot;</span><span class="o">);</span>
                    <span class="n">mOpenCvCameraView</span><span class="o">.</span><span class="na">enableView</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">break</span><span class="o">;</span>
                <span class="k">default</span><span class="o">:</span>
                <span class="o">{</span>
                    <span class="kd">super</span><span class="o">.</span><span class="na">onManagerConnected</span><span class="o">(</span><span class="n">status</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">};</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
        <span class="n">OpenCVLoader</span><span class="o">.</span><span class="na">initAsync</span><span class="o">(</span><span class="n">OpenCVLoader</span><span class="o">.</span><span class="na">OPENCV_VERSION_2_4_6</span><span class="o">,</span> <span class="k">this</span><span class="o">,</span> <span class="n">mLoaderCallback</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>It this case application works with OpenCV Manager in asynchronous fashion. <tt class="docutils literal"><span class="pre">OnManagerConnected</span></tt>
callback will be called in UI thread, when initialization finishes. Please note, that it is not
allowed to use OpenCV calls or load OpenCV-dependent native libs before invoking this callback.
Load your own native libraries that depend on OpenCV after the successful OpenCV initialization.
Default <tt class="docutils literal"><span class="pre">BaseLoaderCallback</span></tt> implementation treat application context as Activity and calls
<tt class="docutils literal"><span class="pre">Activity.finish()</span></tt> method to exit in case of initialization failure. To override this behavior
you need to override <tt class="docutils literal"><span class="pre">finish()</span></tt> method of <tt class="docutils literal"><span class="pre">BaseLoaderCallback</span></tt> class and implement your own
finalization method.</p>
</div>
<div class="section" id="application-development-with-static-initialization">
<h4>Application Development with Static Initialization<a class="headerlink" href="#application-development-with-static-initialization" title="Permalink to this headline">¶</a></h4>
<p>According to this approach all OpenCV binaries are included into your application package. It is
designed mostly for development purposes. This approach is deprecated for the production code,
release package is recommended to communicate with OpenCV Manager via the async initialization
described above.</p>
<ol class="arabic">
<li><p class="first">Add the OpenCV library project to your workspace the same way as for the async initialization
above. Use menu <em class="guilabel">File -&gt; Import -&gt; Existing project in your workspace</em>,
press <em class="guilabel">Browse</em> button and select OpenCV SDK path
(<tt class="file docutils literal"><span class="pre">OpenCV-2.4.9-android-sdk/sdk</span></tt>).</p>
<img alt="Add dependency from OpenCV library" class="align-center" src="../../../../_images/eclipse_opencv_dependency0.png" />
</li>
<li><p class="first">In the application project add a reference to the OpenCV4Android SDK in
<em class="guilabel">Project -&gt; Properties -&gt; Android -&gt; Library -&gt; Add</em> select <tt class="docutils literal"><span class="pre">OpenCV</span> <span class="pre">Library</span> <span class="pre">-</span> <span class="pre">2.4.9</span></tt>;</p>
<img alt="Add dependency from OpenCV library" class="align-center" src="../../../../_images/eclipse_opencv_dependency1.png" />
</li>
<li><p class="first">If your application project <strong>doesn&#8217;t have a JNI part</strong>, just copy the corresponding OpenCV
native libs from <tt class="file docutils literal"><span class="pre">&lt;OpenCV-2.4.9-android-sdk&gt;/sdk/native/libs/&lt;target_arch&gt;</span></tt> to your
project directory to folder <tt class="file docutils literal"><span class="pre">libs/&lt;target_arch&gt;</span></tt>.</p>
<p>In case of the application project <strong>with a JNI part</strong>, instead of manual libraries copying you
need to modify your <tt class="docutils literal"><span class="pre">Android.mk</span></tt> file:
add the following two code lines after the <tt class="docutils literal"><span class="pre">&quot;include</span> <span class="pre">$(CLEAR_VARS)&quot;</span></tt> and before
<tt class="docutils literal"><span class="pre">&quot;include</span> <span class="pre">path_to_OpenCV-2.4.9-android-sdk/sdk/native/jni/OpenCV.mk&quot;</span></tt></p>
<div class="highlight-make"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">OPENCV_CAMERA_MODULES</span><span class="o">:=</span>on
OPENCV_INSTALL_MODULES:<span class="o">=</span>on
</pre></div>
</td></tr></table></div>
<p>The result should look like the following:</p>
<div class="highlight-make"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">include $(CLEAR_VARS)</span>

<span class="c"># OpenCV</span>
<span class="nv">OPENCV_CAMERA_MODULES</span><span class="o">:=</span>on
OPENCV_INSTALL_MODULES:<span class="o">=</span>on
<span class="cp">include ../../sdk/native/jni/OpenCV.mk</span>
</pre></div>
</td></tr></table></div>
<p>After that the OpenCV libraries will be copied to your application <tt class="file docutils literal"><span class="pre">libs</span></tt> folder during
the JNI build.v</p>
<p>Eclipse will automatically include all the libraries from the <tt class="file docutils literal"><span class="pre">libs</span></tt> folder to the
application package (APK).</p>
</li>
<li><p class="first">The last step of enabling OpenCV in your application is Java initialization code before calling
OpenCV API. It can be done, for example, in the static section of the <tt class="docutils literal"><span class="pre">Activity</span></tt> class:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">static</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">OpenCVLoader</span><span class="o">.</span><span class="na">initDebug</span><span class="o">())</span> <span class="o">{</span>
        <span class="c1">// Handle initialization error</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>If you application includes other OpenCV-dependent native libraries you should load them
<strong>after</strong> OpenCV initialization:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">static</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">OpenCVLoader</span><span class="o">.</span><span class="na">initDebug</span><span class="o">())</span> <span class="o">{</span>
        <span class="c1">// Handle initialization error</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">loadLibrary</span><span class="o">(</span><span class="s">&quot;my_jni_lib1&quot;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">loadLibrary</span><span class="o">(</span><span class="s">&quot;my_jni_lib2&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
</li>
</ol>
</div>
</div>
<div class="section" id="native-c">
<h3>Native/C++<a class="headerlink" href="#native-c" title="Permalink to this headline">¶</a></h3>
<p>To build your own Android application, using OpenCV as native part, the following steps should be
taken:</p>
<ol class="arabic">
<li><p class="first">You can use an environment variable to specify the location of OpenCV package or just hardcode
absolute or relative path in the <tt class="file docutils literal"><span class="pre">jni/Android.mk</span></tt> of your projects.</p>
</li>
<li><p class="first">The file <tt class="file docutils literal"><span class="pre">jni/Android.mk</span></tt> should be written for the current application using the common
rules for this file.</p>
<p>For detailed information see the Android NDK documentation from the Android NDK archive, in the
file <tt class="file docutils literal"><span class="pre">&lt;path_where_NDK_is_placed&gt;/docs/ANDROID-MK.html</span></tt>.</p>
</li>
<li><p class="first">The following line:</p>
<div class="highlight-make"><div class="highlight"><pre><span class="cp">include C:\Work\OpenCV4Android\OpenCV-2.4.9-android-sdk\sdk\native\jni\OpenCV.mk</span>
</pre></div>
</div>
<p>Should be inserted into the <tt class="file docutils literal"><span class="pre">jni/Android.mk</span></tt> file <strong>after</strong> this line:</p>
<div class="highlight-make"><div class="highlight"><pre><span class="cp">include $(CLEAR_VARS)</span>
</pre></div>
</div>
</li>
<li><p class="first">Several variables can be used to customize OpenCV stuff, but you <strong>don&#8217;t need</strong> to use them when
your application uses the <cite>async initialization</cite> via the <cite>OpenCV Manager</cite> API.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>These variables should be set <strong>before</strong>  the <tt class="docutils literal"><span class="pre">&quot;include</span> <span class="pre">.../OpenCV.mk&quot;</span></tt> line:</p>
<div class="last highlight-make"><div class="highlight"><pre><span class="nv">OPENCV_INSTALL_MODULES</span><span class="o">:=</span>on
</pre></div>
</div>
</div>
<p>Copies necessary OpenCV dynamic libs to the project <tt class="docutils literal"><span class="pre">libs</span></tt> folder in order to include them
into the APK.</p>
<div class="highlight-make"><div class="highlight"><pre><span class="nv">OPENCV_CAMERA_MODULES</span><span class="o">:=</span>off
</pre></div>
</div>
<p>Skip native OpenCV camera related libs copying to the project <tt class="docutils literal"><span class="pre">libs</span></tt> folder.</p>
<div class="highlight-make"><div class="highlight"><pre><span class="nv">OPENCV_LIB_TYPE</span><span class="o">:=</span>STATIC
</pre></div>
</div>
<p>Perform static linking with OpenCV. By default dynamic link is used and the project JNI lib
depends on <tt class="docutils literal"><span class="pre">libopencv_java.so</span></tt>.</p>
</li>
<li><p class="first">The file <tt class="file docutils literal"><span class="pre">Application.mk</span></tt> should exist and should contain lines:</p>
<div class="highlight-make"><div class="highlight"><pre><span class="nv">APP_STL</span> <span class="o">:=</span> gnustl_static
APP_CPPFLAGS :<span class="o">=</span> -frtti -fexceptions
</pre></div>
</div>
<p>Also, the line like this one:</p>
<div class="highlight-make"><div class="highlight"><pre><span class="nv">APP_ABI</span> <span class="o">:=</span> armeabi-v7a
</pre></div>
</div>
<p>Should specify the application target platforms.</p>
<p>In some cases a linkage error (like <tt class="docutils literal"><span class="pre">&quot;In</span> <span class="pre">function</span> <span class="pre">'cv::toUtf16(std::basic_string&lt;...&gt;...</span>
<span class="pre">undefined</span> <span class="pre">reference</span> <span class="pre">to</span> <span class="pre">'mbstowcs'&quot;</span></tt>) happens when building an application JNI library,
depending on OpenCV. The following line in the <tt class="file docutils literal"><span class="pre">Application.mk</span></tt> usually fixes it:</p>
<div class="highlight-make"><div class="highlight"><pre><span class="nv">APP_PLATFORM</span> <span class="o">:=</span> android-9
</pre></div>
</div>
</li>
<li><p class="first">Either use <a class="reference internal" href="android_dev_intro.html#ndk-build-cli"><em>manual</em></a> <tt class="docutils literal"><span class="pre">ndk-build</span></tt> invocation or
<a class="reference internal" href="android_dev_intro.html#cdt-builder"><em>setup Eclipse CDT Builder</em></a> to build native JNI lib before (re)building the Java
part and creating an APK.</p>
</li>
</ol>
</div>
</div>
<div class="section" id="hello-opencv-sample">
<h2>Hello OpenCV Sample<a class="headerlink" href="#hello-opencv-sample" title="Permalink to this headline">¶</a></h2>
<p>Here are basic steps to guide you trough the process of creating a simple OpenCV-centric
application. It will be capable of accessing camera output, processing it and displaying the
result.</p>
<ol class="arabic">
<li><p class="first">Open Eclipse IDE, create a new clean workspace, create a new Android project
<em class="menuselection">File ‣ New ‣ Android Project</em></p>
</li>
<li><p class="first">Set name, target, package and <tt class="docutils literal"><span class="pre">minSDKVersion</span></tt> accordingly. The minimal SDK version for build
with OpenCV4Android SDK is 11. Minimal device API Level (for application manifest) is 8.</p>
</li>
<li><p class="first">Allow Eclipse to create default activity. Lets name the activity <tt class="docutils literal"><span class="pre">HelloOpenCvActivity</span></tt>.</p>
</li>
<li><p class="first">Choose Blank Activity with full screen layout. Lets name the layout <tt class="docutils literal"><span class="pre">HelloOpenCvLayout</span></tt>.</p>
</li>
<li><p class="first">Import OpenCV library project to your workspace.</p>
</li>
<li><p class="first">Reference OpenCV library within your project properties.</p>
<img alt="Reference OpenCV library." class="align-center" src="../../../../_images/dev_OCV_reference.png" />
</li>
<li><p class="first">Edit your layout file as xml file and pass the following layout there:</p>
<blockquote>
<div><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;LinearLayout</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
    <span class="na">xmlns:tools=</span><span class="s">&quot;http://schemas.android.com/tools&quot;</span>
    <span class="na">xmlns:opencv=</span><span class="s">&quot;http://schemas.android.com/apk/res-auto&quot;</span>
    <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
    <span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span> <span class="nt">&gt;</span>

    <span class="nt">&lt;org.opencv.android.JavaCameraView</span>
        <span class="na">android:layout_width=</span><span class="s">&quot;fill_parent&quot;</span>
        <span class="na">android:layout_height=</span><span class="s">&quot;fill_parent&quot;</span>
        <span class="na">android:visibility=</span><span class="s">&quot;gone&quot;</span>
        <span class="na">android:id=</span><span class="s">&quot;@+id/HelloOpenCvView&quot;</span>
        <span class="na">opencv:show_fps=</span><span class="s">&quot;true&quot;</span>
        <span class="na">opencv:camera_id=</span><span class="s">&quot;any&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/LinearLayout&gt;</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
</li>
<li><p class="first">Add the following permissions to the <tt class="file docutils literal"><span class="pre">AndroidManifest.xml</span></tt> file:</p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;/application&gt;</span>

<span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">&quot;android.permission.CAMERA&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;uses-feature</span> <span class="na">android:name=</span><span class="s">&quot;android.hardware.camera&quot;</span> <span class="na">android:required=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;uses-feature</span> <span class="na">android:name=</span><span class="s">&quot;android.hardware.camera.autofocus&quot;</span> <span class="na">android:required=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;uses-feature</span> <span class="na">android:name=</span><span class="s">&quot;android.hardware.camera.front&quot;</span> <span class="na">android:required=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;uses-feature</span> <span class="na">android:name=</span><span class="s">&quot;android.hardware.camera.front.autofocus&quot;</span> <span class="na">android:required=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first">Set application theme in AndroidManifest.xml to hide title and system buttons.</p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;application</span>
    <span class="na">android:icon=</span><span class="s">&quot;@drawable/icon&quot;</span>
    <span class="na">android:label=</span><span class="s">&quot;@string/app_name&quot;</span>
    <span class="na">android:theme=</span><span class="s">&quot;@android:style/Theme.NoTitleBar.Fullscreen&quot;</span> <span class="nt">&gt;</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first">Add OpenCV library initialization to your activity. Fix errors by adding requited imports.</p>
<blockquote>
<div><div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">private</span> <span class="n">BaseLoaderCallback</span> <span class="n">mLoaderCallback</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BaseLoaderCallback</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onManagerConnected</span><span class="o">(</span><span class="kt">int</span> <span class="n">status</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">switch</span> <span class="o">(</span><span class="n">status</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">case</span> <span class="n">LoaderCallbackInterface</span><span class="o">.</span><span class="na">SUCCESS</span><span class="o">:</span>
            <span class="o">{</span>
                <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;OpenCV loaded successfully&quot;</span><span class="o">);</span>
                <span class="n">mOpenCvCameraView</span><span class="o">.</span><span class="na">enableView</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">break</span><span class="o">;</span>
            <span class="k">default</span><span class="o">:</span>
            <span class="o">{</span>
                <span class="kd">super</span><span class="o">.</span><span class="na">onManagerConnected</span><span class="o">(</span><span class="n">status</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">};</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span>
<span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
    <span class="n">OpenCVLoader</span><span class="o">.</span><span class="na">initAsync</span><span class="o">(</span><span class="n">OpenCVLoader</span><span class="o">.</span><span class="na">OPENCV_VERSION_2_4_6</span><span class="o">,</span> <span class="k">this</span><span class="o">,</span> <span class="n">mLoaderCallback</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
</li>
<li><p class="first">Defines that your activity implements <tt class="docutils literal"><span class="pre">CvCameraViewListener2</span></tt> interface and fix activity related
errors by defining missed methods. For this activity define <tt class="docutils literal"><span class="pre">onCreate</span></tt>, <tt class="docutils literal"><span class="pre">onDestroy</span></tt> and
<tt class="docutils literal"><span class="pre">onPause</span></tt> and implement them according code snippet bellow. Fix errors by adding requited
imports.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="highlight"><pre> <span class="kd">private</span> <span class="n">CameraBridgeViewBase</span> <span class="n">mOpenCvCameraView</span><span class="o">;</span>

 <span class="nd">@Override</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
     <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;called onCreate&quot;</span><span class="o">);</span>
     <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
     <span class="n">getWindow</span><span class="o">().</span><span class="na">addFlags</span><span class="o">(</span><span class="n">WindowManager</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">.</span><span class="na">FLAG_KEEP_SCREEN_ON</span><span class="o">);</span>
     <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">HelloOpenCvLayout</span><span class="o">);</span>
     <span class="n">mOpenCvCameraView</span> <span class="o">=</span> <span class="o">(</span><span class="n">CameraBridgeViewBase</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">HelloOpenCvView</span><span class="o">);</span>
     <span class="n">mOpenCvCameraView</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">SurfaceView</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">);</span>
     <span class="n">mOpenCvCameraView</span><span class="o">.</span><span class="na">setCvCameraViewListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
 <span class="o">}</span>

 <span class="nd">@Override</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onPause</span><span class="o">()</span>
 <span class="o">{</span>
     <span class="kd">super</span><span class="o">.</span><span class="na">onPause</span><span class="o">();</span>
     <span class="k">if</span> <span class="o">(</span><span class="n">mOpenCvCameraView</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
         <span class="n">mOpenCvCameraView</span><span class="o">.</span><span class="na">disableView</span><span class="o">();</span>
 <span class="o">}</span>

 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>
     <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
     <span class="k">if</span> <span class="o">(</span><span class="n">mOpenCvCameraView</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
         <span class="n">mOpenCvCameraView</span><span class="o">.</span><span class="na">disableView</span><span class="o">();</span>
 <span class="o">}</span>

 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCameraViewStarted</span><span class="o">(</span><span class="kt">int</span> <span class="n">width</span><span class="o">,</span> <span class="kt">int</span> <span class="n">height</span><span class="o">)</span> <span class="o">{</span>
 <span class="o">}</span>

 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCameraViewStopped</span><span class="o">()</span> <span class="o">{</span>
 <span class="o">}</span>

 <span class="kd">public</span> <span class="n">Mat</span> <span class="nf">onCameraFrame</span><span class="o">(</span><span class="n">CvCameraViewFrame</span> <span class="n">inputFrame</span><span class="o">)</span> <span class="o">{</span>
     <span class="k">return</span> <span class="n">inputFrame</span><span class="o">.</span><span class="na">rgba</span><span class="o">();</span>
 <span class="o">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first">Run your application on device or emulator.</p>
</li>
</ol>
<p>Lets discuss some most important steps. Every Android application with UI must implement Activity
and View. By the first steps we create blank activity and default view layout. The simplest
OpenCV-centric application must implement OpenCV initialization, create its own view to show
preview from camera and implements <tt class="docutils literal"><span class="pre">CvCameraViewListener2</span></tt> interface to get frames from camera and
process it.</p>
<p>First of all we create our application view using xml layout. Our layout consists of the only
one full screen component of class <tt class="docutils literal"><span class="pre">org.opencv.android.JavaCameraView</span></tt>. This class is
implemented inside OpenCV library. It is inherited from <tt class="docutils literal"><span class="pre">CameraBridgeViewBase</span></tt>, that extends
<tt class="docutils literal"><span class="pre">SurfaceView</span></tt> and uses standard Android camera API. Alternatively you can use
<tt class="docutils literal"><span class="pre">org.opencv.android.NativeCameraView</span></tt> class, that implements the same interface, but uses
<tt class="docutils literal"><span class="pre">VideoCapture</span></tt> class as camera access back-end. <tt class="docutils literal"><span class="pre">opencv:show_fps=&quot;true&quot;</span></tt> and
<tt class="docutils literal"><span class="pre">opencv:camera_id=&quot;any&quot;</span></tt> options enable FPS message and allow to use any camera on device.
Application tries to use back camera first.</p>
<p>After creating layout we need to implement <tt class="docutils literal"><span class="pre">Activity</span></tt> class. OpenCV initialization process has
been already discussed above. In this sample we use asynchronous initialization. Implementation of
<tt class="docutils literal"><span class="pre">CvCameraViewListener</span></tt> interface allows you to add processing steps after frame grabbing from
camera and before its rendering on screen. The most important function is <tt class="docutils literal"><span class="pre">onCameraFrame</span></tt>. It is
callback function and it is called on retrieving frame from camera. The callback input is object
of <tt class="docutils literal"><span class="pre">CvCameraViewFrame</span></tt> class that represents frame from camera.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Do not save or use <tt class="docutils literal"><span class="pre">CvCameraViewFrame</span></tt> object out of <tt class="docutils literal"><span class="pre">onCameraFrame</span></tt> callback. This object
does not have its own state and its behavior out of callback is unpredictable!</p>
</div>
<p>It has <tt class="docutils literal"><span class="pre">rgba()</span></tt> and <tt class="docutils literal"><span class="pre">gray()</span></tt> methods that allows to get frame as RGBA and one channel gray scale
<tt class="docutils literal"><span class="pre">Mat</span></tt> respectively. It expects that <tt class="docutils literal"><span class="pre">onCameraFrame</span></tt> function returns RGBA frame that will be
drawn on the screen.</p>
</div>
</div>


          </div>
          <div class="feedback">
              <h2>Help and Feedback</h2>
              You did not find what you were looking for?
              <ul>
                  
                  
                  
                  <li>Ask a question on the <a href="http://answers.opencv.org">Q&A forum</a>.</li>
                  <li>If you think something is missing or wrong in the documentation,
                  please file a <a href="http://code.opencv.org">bug report</a>.</li>
              </ul>
          </div>
        </div>
      </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../index.html">
              <img class="logo" src="../../../../_static/opencv-logo-white.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
      <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Search" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
      </p>
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <h3><a href="../../../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Android Development with OpenCV</a><ul>
<li><a class="reference internal" href="#using-opencv-library-within-your-android-project">Using OpenCV Library Within Your Android Project</a><ul>
<li><a class="reference internal" href="#java">Java</a><ul>
<li><a class="reference internal" href="#application-development-with-async-initialization">Application Development with Async Initialization</a></li>
<li><a class="reference internal" href="#application-development-with-static-initialization">Application Development with Static Initialization</a></li>
</ul>
</li>
<li><a class="reference internal" href="#native-c">Native/C++</a></li>
</ul>
</li>
<li><a class="reference internal" href="#hello-opencv-sample">Hello OpenCV Sample</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="O4A_SDK.html"
                        title="previous chapter">OpenCV4Android SDK</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../ios_install/ios_install.html"
                        title="next chapter">Installation in iOS</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../../../_sources/doc/tutorials/introduction/android_binary_package/dev_with_OCV_on_Android.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../ios_install/ios_install.html" title="Installation in iOS"
             >next</a> |</li>
        <li class="right" >
          <a href="O4A_SDK.html" title="OpenCV4Android SDK"
             >previous</a> |</li>
        <li><a href="../../../../index.html">OpenCV 2.4.9.0 documentation</a> &raquo;</li>
          <li><a href="../../tutorials.html" >OpenCV Tutorials</a> &raquo;</li>
          <li><a href="../table_of_content_introduction/table_of_content_introduction.html" >Introduction to OpenCV</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011-2014, opencv dev team.
      Last updated on Apr 21, 2014.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>